source("P:/Retraites/PENSIPP 0.0/Modèle/Outils/OutilsRetraite/OutilsMS.R")
source("P:/Retraites/PENSIPP 0.0/Modèle/Outils/OutilsRetraite/OutilsDestinie.R")
source("P:/Retraites/PENSIPP 0.0/Modèle/Outils/OutilsRetraite/DefVarRetr_Destinie.R")
setwd("P:/Retraites/PENSIPP 0.0/Outils/OutilsBio")
# Lecture donnÃ©es d'Ã©tat initial (NB : le tableau intermÃ©diaire buf est lu sous forme de dataframe
# et immÃ©diatement converti en type matrix, ce qui est nÃ©cessaire pour l'extraction de la
# sous-matrice des identifiants des enfants)
buf                          <- read.csv2("popini.csv",header=FALSE)
buf                          <- as.matrix(buf)
n                            <- nrow(buf)
print (c(n," individus lus dans PopIni.csv"))
statut[1:n,t_deb]            <- buf[,2]
anaiss[1:n]                  <- buf[,3]
sexe[1:n]                    <- buf[,4]
findet[1:n]                  <- buf[,5]
pere[1:n]                    <- buf[,6]
mere[1:n]                    <- buf[,7]
n_enf[1:n]                   <- buf[,8]
enf[1:n,1:nb_enf_max]        <- buf[1:n,9:(8+nb_enf_max)]
age[which(statut[,t_deb]>0)] <- t_deb-anaiss[which(statut[,t_deb]>0)]+1
trim_naiss                   <- runif(1:taille_max)
trim_act                     <- runif(1:taille_max)-0.5
moisnaiss                    <- round (trim_naiss*11)
# Lecture carriÃ¨res et biographies matrimoniales
buf                          <- read.csv2("biosta4.csv",header=FALSE)
buf                          <- as.matrix(buf)
n                            <- nrow(buf)
print (c(n," individus lus dans BioSta4.csv"))
statut[1:n,1:t_fin]        <- buf[1:n,2:161]
buf                          <- read.csv2("biosal4.csv",header=FALSE)
buf                          <- as.matrix(buf)
n                            <- nrow(buf)
print (c(n," individus lus dans BioSal4.csv"))
salaire[1:n,1:t_fin]        <- buf[1:n,2:161]
buf                        <- read.csv2("biomat4.csv",header=FALSE)
buf                        <- as.matrix(buf)
n                          <- nrow(buf)
print (c(n," individus lus dans BioMat4.csv"))
conjoint[1:n,1:t_deb]      <- buf[1:n,2:110]
source("P:/Retraites/PENSIPP 0.0/Modèle/Outils/OutilsRetraite/OutilsMS.R")
source("P:/Retraites/PENSIPP 0.0/Modèle/Outils/OutilsRetraite/OutilsDestinie.R")
source("P:/Retraites/PENSIPP 0.0/Modèle/Outils/OutilsRetraite/DefVarRetr_Destinie.R")
setwd("P:/Retraites/PENSIPP 0.0/Modèle/Paramètres/Destinie/Importation des bios")
# Lecture donnÃ©es d'Ã©tat initial (NB : le tableau intermÃ©diaire buf est lu sous forme de dataframe
# et immÃ©diatement converti en type matrix, ce qui est nÃ©cessaire pour l'extraction de la
# sous-matrice des identifiants des enfants)
buf                          <- read.csv2("popini.csv",header=FALSE)
buf                          <- as.matrix(buf)
n                            <- nrow(buf)
print (c(n," individus lus dans PopIni.csv"))
statut[1:n,t_deb]            <- buf[,2]
anaiss[1:n]                  <- buf[,3]
sexe[1:n]                    <- buf[,4]
findet[1:n]                  <- buf[,5]
pere[1:n]                    <- buf[,6]
mere[1:n]                    <- buf[,7]
n_enf[1:n]                   <- buf[,8]
enf[1:n,1:nb_enf_max]        <- buf[1:n,9:(8+nb_enf_max)]
age[which(statut[,t_deb]>0)] <- t_deb-anaiss[which(statut[,t_deb]>0)]+1
trim_naiss                   <- runif(1:taille_max)
trim_act                     <- runif(1:taille_max)-0.5
moisnaiss                    <- round (trim_naiss*11)
# Lecture carriÃ¨res et biographies matrimoniales
buf                          <- read.csv2("biosta4.csv",header=FALSE)
buf                          <- as.matrix(buf)
n                            <- nrow(buf)
print (c(n," individus lus dans BioSta4.csv"))
statut[1:n,1:t_fin]        <- buf[1:n,2:161]
buf                          <- read.csv2("biosal4.csv",header=FALSE)
buf                          <- as.matrix(buf)
n                            <- nrow(buf)
print (c(n," individus lus dans BioSal4.csv"))
salaire[1:n,1:t_fin]        <- buf[1:n,2:161]
buf                        <- read.csv2("biomat4.csv",header=FALSE)
buf                        <- as.matrix(buf)
n                          <- nrow(buf)
print (c(n," individus lus dans BioMat4.csv"))
conjoint[1:n,1:t_deb]      <- buf[1:n,2:110]
#Obtenir les missing:
MV<-numeric(taille_max)
MV<- rowSums(statut)
MV[!is.na(MV)]<-0
MV[is.na(MV)]<-1
MV<-MV*seq_len(nrow(statut))
listMV<-MV[MV!=0]
print (listMV)
#Solution provisoire: inactif quand missing
statut[is.na(statut)]<- -3
# variables micro annexes
liste        <- numeric(taille_max)
liste_h      <- numeric(taille_max)
liste_f      <- numeric(taille_max)
proba        <- numeric(taille_max)
n_enf_c      <- numeric(taille_max)
aidants      <- numeric(taille_max)
parents      <- numeric(taille_max)
# Lecture des donnÃ©es de projection
pop          <- array(0,dim=c(2,age_max,t_fin))
deces        <- array(0,dim=c(2,age_max,t_fin))
mig          <- array(0,dim=c(2,age_max,t_fin))
naissances   <- array(0,dim=c(  age_max,t_fin))
pop[1,,]     <- read_ap("PopHommes.csv"     ,age="colonne")
pop[2,,]     <- read_ap("PopFemmes.csv"     ,age="colonne")
deces[1,,]   <- read_ap("DecesHommes.csv"   ,age="colonne")
deces[2,,]   <- read_ap("DecesFemmes.csv"   ,age="colonne")
mig[1,,]     <- read_ap("SoldeMigHommes.csv",age="colonne")
mig[2,,]     <- read_ap("SoldeMigFemmes.csv",age="colonne")
naissances   <- read_ap("Naissances.csv"    ,age="colonne")
# DonnÃ©es intermÃ©diaires et d'output
naiss_tot     <- array(dim=c(t_fin))
naiss_tot_sim <- array(dim=c(t_fin))
popini        <- array(dim=c(1,age_max))
popsim        <- array(dim=c(2,age_max,t_fin))
migsim        <- array(dim=c(2,age_max,t_fin))
en_couple     <- array(dim=c(2,age_max,t_fin))
###############  BIOS DESTINIE  ******************
# Extraction des biographie individuelle (liens familiaux, statuts, salaire) de la base de Destinie 2009.
# Programmes conjoint et statut dans P:\Retraites\Destinie\VersR
source("P:/Retraites/PENSIPP 0.0/Modèle/Outils/OutilsRetraite/OutilsMS.R")
source("P:/Retraites/PENSIPP 0.0/Modèle/Outils/OutilsRetraite/OutilsDestinie.R")
source("P:/Retraites/PENSIPP 0.0/Modèle/Outils/OutilsRetraite/DefVarRetr_Destinie.R")
setwd("P:/Retraites/PENSIPP 0.0/Modèle/Paramètres/Destinie/Importation des bios")
# Lecture donnÃ©es d'Ã©tat initial (NB : le tableau intermÃ©diaire buf est lu sous forme de dataframe
# et immÃ©diatement converti en type matrix, ce qui est nÃ©cessaire pour l'extraction de la
# sous-matrice des identifiants des enfants)
buf                          <- read.csv2("pop.csv",header=FALSE)
buf                          <- as.matrix(buf)
n                            <- nrow(buf)
taille_max                   <- n+1
print (c(n," individus lus dans Pop.csv"))
anaiss[1:n]                  <- buf[,3]
sexe[1:n]                    <- buf[,4]
findet[1:n]                  <- buf[,5]
pere[1:n]                    <- buf[,6]
mere[1:n]                    <- buf[,7]
n_enf[1:n]                   <- buf[,8]
enf[1:n,1:nb_enf_max]        <- buf[1:n,9:(8+nb_enf_max)]
age[which(statut[,t_deb]>0)] <- t_deb-anaiss[which(statut[,t_deb]>0)]+1
trim_naiss                   <- runif(1:taille_max)
trim_act                     <- runif(1:taille_max)-0.5
moisnaiss                    <- round (trim_naiss*11)
# Lecture carriÃ¨res et biographies matrimoniales
buf                          <- read.csv2("biosta.csv",header=FALSE)
buf                          <- as.matrix(buf)
n                            <- nrow(buf)
print (c(n," individus lus dans BioSta.csv"))
statut[1:n,1:t_fin]        <- buf[1:n,2:161]
# Decede quands plus de statut
statut[is.na(statut)]<- -3
buf                          <- read.csv2("biosal4.csv",header=FALSE)
buf                          <- as.matrix(buf)
n                            <- nrow(buf)
print (c(n," individus lus dans BioSal4.csv"))
salaire[1:n,1:t_fin]        <- buf[1:n,2:161]
# =0 quands plus de statut
salaire[is.na(salaire)]<- 0
buf                        <- read.csv2("biomat4.csv",header=FALSE)
buf                        <- as.matrix(buf)
n                          <- nrow(buf)
print (c(n," individus lus dans BioMat4.csv"))
conjoint[1:n,1:160]      <- buf[1:n,2:161]
### Periodes de chomage indemnise
salrefchom <- matrix (0     ,nrow=taille_max,ncol=t_fin     )
chomind    <- matrix (0     ,nrow=taille_max,ncol=t_fin     )
for (t in 1:160)
{
for (i in 1:taille_max)
{
if ( (statut[i,t]== chomeur) && ((statut[i,(t-1)]==cadre) ||((statut[i,(t-2)]==cadre)&&(chomind[i,(t-1)]==1) ) ) )
{
chomind[i,t] <- 1
#  #On prend comme assiete le dernier salaire percu avant chomage
liste <- which(statut[i,1:(t-1)]==cadre)
salrefchom[i,t]  <- salaire[i,liste[length(liste)]]
}
if ((statut[i,t]== chomeur) && ((statut[i,(t-1)]==non_cadre) ||((statut[i,(t-2)]==non_cadre)&&(chomind[i,(t-1)]==1) ) ) )
{
chomind[i,t] <- 1
#  #On prend comme assiete le dernier salaire percu avant chomage
liste <- which(statut[i,1:(t-1)]==cadre)
salrefchom[i,t]  <- max(0,salaire[i,liste[length(liste)]])
}
}
}
# Variables sauvegardées
View(salaire)
View(statut)
View(salaire)
View(salrefchom)
View(salrefchom)
